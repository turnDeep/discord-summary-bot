# Discord Summary Bot - 全チャンネル監視版

このボットは、招待されたDiscordサーバーの**全てのテキストチャンネル**を自動的に監視し、定期的に会話の要約を生成してbot専用チャンネルに投稿します。

## 主な特徴

- **全チャンネル自動監視**: 招待されたサーバーの全テキストチャンネルを自動的に監視
- **自動チャンネル作成**: bot専用の要約チャンネル（`bot-summaries`）を自動作成
- **1時間ごとの定期要約**: 1件以上の投稿があれば、全チャンネルの活動を統合して要約
- **Gemini 2.5 Pro使用**: Google の最新AIモデルで高品質な要約を生成
- **複数サーバー対応**: 複数のサーバーに招待されても、それぞれ独立して動作
- **プライバシー配慮**: bot専用チャンネルへの投稿は要約対象外

## 動作の仕組み

1. **ボットをサーバーに招待**すると、自動的に `bot-summaries` チャンネルを作成（または既存のものを使用）
2. **全てのテキストチャンネル**でのメッセージを監視・記録
3. **1時間ごと**に、全チャンネルの活動をまとめて要約を生成
4. **1件以上**のメッセージがあれば、`bot-summaries` チャンネルに要約を投稿

## 必要な要件

- Python 3.11+
- Discord Bot Token
- Google API Key (Gemini API用)
- 必要な権限:
  - メッセージを読む
  - メッセージを送信する
  - チャンネルを管理する（bot用チャンネル作成のため）
  - 埋め込みリンク

## セットアップ

### 1. 依存関係のインストール

```bash
pip install -r requirements.txt
```

### 2. 環境設定

`.env` ファイルを作成し、以下の内容を設定：

```env
# Discord Bot Token (必須)
DISCORD_BOT_TOKEN=your_discord_bot_token

# Google API Key (必須)
GOOGLE_API_KEY=your_google_api_key

# オプション設定
GEMINI_MODEL=gemini-2.5-pro      # 使用するモデル
BOT_CHANNEL_NAME=bot-summaries   # Bot用チャンネル名
SUMMARY_INTERVAL=60               # 要約間隔（分）
MAX_MESSAGES_PER_SUMMARY=100      # 1回の要約の最大メッセージ数
```

### 3. ボットの起動

```bash
python bot.py
```

## コマンド一覧

| コマンド | 説明 | 権限 |
|---------|------|------|
| `!summary` | 現在のサーバーの要約を手動で生成 | 全員 |
| `!status` | ボットの現在の状態を表示（監視中のチャンネル、バッファ内のメッセージ数など） | 全員 |
| `!toggle_summary` | このサーバーの自動要約のON/OFF切り替え | 管理者 |
| `!set_summary_channel #channel` | 要約の投稿先チャンネルを変更 | 管理者 |
| `!api_usage` | Gemini APIの使用状況を表示 | 管理者 |
| `!system` | システムリソースの使用状況を表示 | 管理者 |

## 要約の内容

要約には以下の情報が含まれます：

1. **統計情報**
   - 総メッセージ数
   - アクティブなチャンネル数
   - 投稿者数

2. **チャンネル別活動状況**
   - 最もアクティブなチャンネルTOP5

3. **AI生成の要約**
   - 各チャンネルの主要なトピック
   - 重要な決定事項や合意事項
   - 注目すべき情報
   - 全体的な活動状況

## プライバシーとセキュリティ

- ボットは招待されたサーバー内のメッセージのみアクセス可能
- bot専用チャンネル（`bot-summaries`）への投稿は監視対象外
- メッセージは一時的にメモリに保存され、要約後は削除
- 他のサーバーの情報にはアクセスできません

## 複数サーバーでの使用

- 複数のサーバーにボットを招待可能
- 各サーバーで独立して動作
- サーバーごとに異なる要約チャンネルを設定可能
- サーバーごとに要約機能のON/OFF切り替え可能

## トラブルシューティング

### bot-summariesチャンネルが作成されない
- ボットに「チャンネルを管理する」権限があることを確認
- 手動でチャンネルを作成し、`!set_summary_channel` で設定も可能

### 要約が投稿されない
- `!status` コマンドで監視状況を確認
- `!toggle_summary` で要約機能が有効になっているか確認
- 1時間以内に1件以上のメッセージがあったか確認

### 特定のチャンネルを監視対象外にしたい
- 現在のバージョンでは、ボットがアクセスできる全チャンネルが監視対象
- チャンネルの権限設定でボットのアクセスを制限することで対応可能

## 注意事項

- 大規模なサーバー（多数のアクティブチャンネル）では、要約が長くなる可能性があります
- Gemini APIの日次制限（1,500回）に注意してください
- メッセージ量が多い場合、メモリ使用量が増加する可能性があります

## ライセンス

このプロジェクトは教育・個人利用を目的として提供されています。